import{a as L,b as W,c as q}from"./chunk-4K4HFQCG.js";import{Bb as N,Hb as F,Sb as V,ec as S,fc as B,hc as E,ic as z,qc as $,qd as H,r as I}from"./chunk-IOXFKTXG.js";import{$b as i,Ac as U,Ca as h,Cc as _,Cd as M,Da as A,Jc as P,Kc as v,Na as d,Nb as y,Oa as u,Pb as k,ac as n,bc as x,fc as C,ic as c,kc as f,rd as D,sa as T,sb as l,tc as w,uc as o,ud as j,vc as b,xa as m,xd as G,yc as R,zc as O}from"./chunk-6VSO6ENM.js";var Y=(()=>{class s{constructor(){this.router=m(I),this.rolesSrv=m(B),this.permissionsSrv=m(S),this.currentRole="",this.currentPermissions=[],this.permissionsOfRole={ADMIN:["canAdd","canDelete","canEdit","canRead"],MANAGER:["canAdd","canEdit","canRead"],GUEST:["canRead"]}}ngOnInit(){this.currentRole=Object.keys(this.rolesSrv.getRoles())[0],console.log("this.currentRole"),console.log(this.currentRole),this.currentPermissions=Object.keys(this.permissionsSrv.getPermissions())}onPermissionChange(){this.currentPermissions=this.permissionsOfRole[this.currentRole],this.rolesSrv.flushRolesAndPermissions(),this.rolesSrv.addRoleWithPermissions(this.currentRole,this.currentPermissions),console.log("this.currentRole"),console.log(this.currentRole),this.router.navigateByUrl("/dashboard")}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=h({type:s,selectors:[["app-permissions-route-guard"]],standalone:!0,features:[_],decls:20,vars:7,consts:[[3,"ngModelChange","change","ngModel"],["value","ADMIN"],["value","MANAGER"],["value","GUEST"]],template:function(e,r){e&1&&(x(0,"page-header"),i(1,"p"),o(2,` The route will be redirected to dashboard after change permission.
`),n(),i(3,"mat-button-toggle-group",0),U("ngModelChange",function(p){return O(r.currentRole,p)||(r.currentRole=p),p}),c("change",function(){return r.onPermissionChange()}),i(4,"mat-button-toggle",1),o(5,"ADMIN"),n(),i(6,"mat-button-toggle",2),o(7,"MANAGER"),n(),i(8,"mat-button-toggle",3),o(9,"GUEST"),n()(),i(10,"p"),o(11," Your current role: "),i(12,"code"),o(13),P(14,"json"),n()(),i(15,"p"),o(16," Your current permissions: "),i(17,"code"),o(18),P(19,"json"),n()()),e&2&&(l(3),R("ngModel",r.currentRole),l(10),b(v(14,3,r.currentRole)),l(5),b(v(19,5,r.currentPermissions)))},dependencies:[G,V,N,F,q,L,W,$]})}}return s})();var K=(()=>{class s{static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275mod=A({type:s})}static{this.\u0275inj=T({imports:[M]})}}return s})();function ee(s,X){if(s&1){let t=C();i(0,"li")(1,"span"),o(2),n(),i(3,"div",11)(4,"button",12),c("click",function(){let r=d(t).$implicit,a=f();return u(a.adjustUserPermissions(r,"ADMIN"))}),o(5,"Set Admin"),n(),i(6,"button",13),c("click",function(){let r=d(t).$implicit,a=f();return u(a.adjustUserPermissions(r,"MANAGER"))}),o(7,"Set Manager"),n(),i(8,"button",14),c("click",function(){let r=d(t).$implicit,a=f();return u(a.adjustUserPermissions(r,"GUEST"))}),o(9,"Set Guest"),n()()()}if(s&2){let t=X.$implicit;l(2),b(t.email)}}var Q=(()=>{class s{constructor(){this.permissionsSrv=m(S),this.firebasePermissionsSrv=m(H),this.comparedPermission=["guest"]}ngOnInit(){this.loadUsers()}loadUsers(){this.users$=this.firebasePermissionsSrv.getAllUsers()}getPermissions(){return Object.keys(this.permissionsSrv.getPermissions())}addPermission(){this.permissionsSrv.addPermission("admin",()=>new Promise((t,e)=>{setTimeout(()=>t(!0),2e3)}))}removePermission(){this.permissionsSrv.removePermission("admin")}unAuthorized(){console.log("unAuthorized")}authorized(){console.log("authorizes")}changeToAdmin(){this.comparedPermission=["admin"],console.log(this.comparedPermission)}changeToAnotherPermission(){this.comparedPermission=["awesome"],console.log(this.comparedPermission)}changeToGuest(){this.comparedPermission=["guest"],console.log(this.comparedPermission)}createUser(t,e){let r=this.firebasePermissionsSrv.auth.currentUser;if(r){let a=r.email||"";this.firebasePermissionsSrv.createUser(t,e,a,"1tlcone").subscribe(()=>{console.log("User created successfully."),this.loadUsers()},g=>{console.error("Error creating user 1:",g)})}else console.error("No authenticated user found.")}adjustUserPermissions(t,e){this.firebasePermissionsSrv.adjustUserPermissions(t.uid,e).subscribe(()=>{this.users$=this.firebasePermissionsSrv.getAllUsers()})}adjustUserPermissions2(t,e){console.log({permission:e}),t.permissions.includes(e)?t.permissions=t.permissions.filter(r=>r!==e):t.permissions.push(e),this.firebasePermissionsSrv.setUserPermissions(t.uid,t.permissions).subscribe(()=>{this.loadUsers()})}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=h({type:s,selectors:[["app-permissions-test"]],standalone:!0,features:[_],decls:22,vars:3,consts:[["emailInput",""],["passwordInput",""],[1,"container"],[1,"create-user-section"],[1,"input-group"],["type","email","required",""],["type","password","required",""],[1,"btn-create-user",3,"click"],[1,"list-users-section"],[1,"user-list"],[4,"ngFor","ngForOf"],[1,"btn-group"],[1,"btn-set-admin",3,"click"],[1,"btn-set-manager",3,"click"],[1,"btn-set-guest",3,"click"]],template:function(e,r){if(e&1){let a=C();i(0,"div",2)(1,"div",3)(2,"h2"),o(3,"Create User"),n(),i(4,"div",4)(5,"label"),o(6,"Email:"),n(),x(7,"input",5,0),n(),i(9,"div",4)(10,"label"),o(11,"Password:"),n(),x(12,"input",6,1),n(),i(14,"button",7),c("click",function(){d(a);let g=w(8),Z=w(13);return u(r.createUser(g.value,Z.value))}),o(15,"Create User"),n()(),i(16,"div",8)(17,"h2"),o(18,"List of Users"),n(),i(19,"ul",9),y(20,ee,10,1,"li",10),P(21,"async"),n()()()}e&2&&(l(20),k("ngForOf",v(21,1,r.users$)))},dependencies:[K,z,M,D,j],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.create-user-section[_ngcontent-%COMP%], .list-users-section[_ngcontent-%COMP%]{width:80%;padding:16px;margin-bottom:24px;border-radius:8px;box-shadow:0 2px 4px #0000001a}.create-user-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .list-users-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:12px;font-size:20px}.input-group[_ngcontent-%COMP%]{margin-bottom:12px}.input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:4px}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px}.btn-create-user[_ngcontent-%COMP%], .btn-set-admin[_ngcontent-%COMP%], .btn-set-manager[_ngcontent-%COMP%], .btn-set-guest[_ngcontent-%COMP%]{padding:10px 20px;margin-right:8px;cursor:pointer;background-color:#3f51b5;border:none;border-radius:4px}.btn-group[_ngcontent-%COMP%]{margin-top:8px}.user-list[_ngcontent-%COMP%]{padding:0;list-style:none}.user-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #ccc}.user-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}"]})}}return s})();var Ie=[{path:"route-guard",component:Y,canActivate:[E],data:{permissions:{except:"GUEST",redirectTo:"/dashboard"}}},{path:"test",component:Q,canActivate:[E],data:{permissions:{except:"GUEST",redirectTo:"/dashboard"}}}];export{Ie as routes};
